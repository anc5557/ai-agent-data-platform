# 기술적 챌린지 & 해결

> 이 문서는 프로젝트 진행 중 겪었던 핵심 기술적 과제와 해결 방법을 정리합니다.

---

## 1. 엔드투엔드 아키텍처 설계

### 🔴 문제

`Iceberg`, `Airflow`, `Milvus`, `LangGraph`, `RAG` 등 여러 기술을 하나의 플랫폼으로 통합하는 프로젝트였지만, **처음부터 전체 구조를 설계해야 하는 상황**이었습니다.

- 어디서부터 설계를 시작해야 하는지
- 데이터 흐름과 레이어 간 경계를 어떻게 정의할지
- 각 컴포넌트가 어떤 형태의 데이터를 주고받아야 하는지

참고할 내부 레퍼런스가 없었기 때문에 모든 결정을 스스로 내려야 했습니다.

### ✅ 해결

**"AI가 이해할 수 있는 형태로 문서화"** 전략을 선택했습니다.

```text
1. 데이터 소스별 스키마 정의
   └── 필드, 키, 시간 축, 관계를 상세히 기술

2. Iceberg 테이블 구조 설계
   └── CREATE TABLE DDL + 컬럼별 의미 정리

3. 레이어별 변환 규칙 문서화
   └── Bronze → Silver → Gold 변환 로직

4. LLM 활용 설계 검토
   └── 문서를 LLM에 제공하고 ETL, 인덱싱, 에이전트 구조 피드백
```

#### 핵심 원칙

- **본문은 Markdown으로 통일** → 문서 포맷의 일관성 확보
- **메타데이터는 Iceberg 테이블 컬럼으로** → 구조적 쿼리 가능

이 접근법 덕분에:

- 설계 품질이 높아지고
- 이후 파이프라인/에이전트 구현이 수월해졌으며
- 신규 데이터 소스 추가 시에도 동일한 패턴을 재사용할 수 있게 되었습니다.

---

## 2. 현업 요구사항 이해

### 🔴 문제

클라우드개발팀, 영업팀의 업무 방식과 고충을 직접 경험해보지 않은 상태였습니다.

**"데이터 플랫폼으로 무엇을 해결해줘야 의미가 있는지"** 를 정의하기 어려웠습니다.

### ✅ 해결

**티타임, 회의, 비공식 대화**를 통해 현업의 목소리를 직접 들었습니다.

### 사례 1: 클라우드개발팀 - 개인 채널 문의 문제

| 이해관계자 | 고충 |
|-----------|------|
| 관리자 | 문의가 어디로 들어오는지 전체적으로 안 보임 |
| 엔지니어 | 개인 채널로 계속 연락 와서 부담, 근무 외 연락도 있음 |
| 고객사 | 담당자 부재 시 지원 수준 저하 |

#### 해결 구조

```text
AS-IS:  고객 → 개인 전화/메일/메신저 → 담당자
        (히스토리 유실, 부재 시 대응 불가)

TO-BE:  고객 → 공용 메일/Google Form
              ↓
        자동 GitHub Issue 생성 → 이슈 프로젝트에서 통합 관리
              ↓
        Iceberg 테이블 적재 → GitHub 이슈 에이전트로 조회
```

**결과:**

- 관리자: 전체 문의 현황 한 화면에서 확인
- 엔지니어: 개인 채널 부담 감소
- 고객사: 담당자 부재 시에도 일정 수준 지원 가능

### 사례 2: 영업팀 - GCLD 운영 데이터 활용

영업팀의 요구:

> "기존 고객사 운영 데이터를 기반으로 추가 영업 기회를 찾고 싶다"

예시: "A 고객사는 메일 발송량이 급증했으니, 일일 발송 한도 상향을 제안해보자"

#### 해결 구조

```text
공공메일 운영 데이터 + 계약 데이터
          ↓
    Gold 테이블 설계
          ↓
    GCLD 에이전트 개발
          ↓
    영업팀이 직접 질의:
    - "A 고객사 사용 추이"
    - "계약 대비 여유/초과 여부"
    - "발송량·용량·유저 수 변화"
```

**결과:** 기존에 개발자에게 요청해야 했던 분석을 영업팀이 직접 수행

---

## 3. 스트리밍 마크다운 테이블 렌더링

### 🔴 문제

SSE로 AI 응답을 스트리밍할 때, **불완전한 마크다운 테이블**이 도착하면 `marked.parse()`가 실패했습니다.

```markdown
<!-- 스트리밍 중 도착한 불완전한 테이블 -->
| 고객사 | 이슈 수 |
| CustomerA | 15
```

### ✅ 해결

**테이블 자동 완성 로직**을 구현했습니다.

```typescript
function completeIncompleteTable(content: string): string {
  const lines = content.split('\n')
  
  // 1. 테이블 헤더 있지만 구분선 없는 경우 → 임시 삽입
  if (hasTableHeader && !hasSeparator) {
    lines.splice(headerIndex + 1, 0, generateSeparator(columnCount))
  }
  
  // 2. 마지막 행이 불완전한 경우 → 셀 패딩
  if (lastRowCells < columnCount) {
    lines[lines.length - 1] += ' |'.repeat(columnCount - lastRowCells)
  }
  
  return lines.join('\n')
}
```

**결과:** 스트리밍 중에도 테이블이 올바르게 렌더링됨

---

## 핵심 교훈

| 영역 | 배운 점 |
|------|---------|
| **설계** | AI/LLM이 이해할 수 있는 형태로 데이터를 문서화하면 설계 품질이 높아짐 |
| **현업 이해** | 티타임/회의로 업무 흐름과 고충을 이해해야 "도움이 되는 시스템"이 됨 |
| **구조화** | 본문=Markdown, 메타데이터=Iceberg 테이블 통일이 다양한 소스 통합에 효과적 |
